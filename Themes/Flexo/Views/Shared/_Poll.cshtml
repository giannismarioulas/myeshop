@*
    // ***	 ** ****** ****** ****** ******* **     ** ****** ***   ** **** ****
    // ****  ** **  ** **  ** **  **  **  **  **   **  **  ** ****  ** *    *
    // ** ** ** **  ** ****** ******  **  **   ** **   ****** ** ** ** *    ***
    // **  **** **  ** **	  **  **  **  **    ***    **  ** **  **** *    *
    // **   *** ****** **	  **  ** *******     *     **  ** **   *** **** ****
    //
    // **************************************************************************
    // *                                                                		*
	// *                      Flexo by NopAdvance team                          *
    // *			Copyright (c) NopAdvance LLP. All Rights Reserved			*
    // *                                                                       	*
    // **************************************************************************
    // *                                                                       	*
    // * Email:		contact@nopadvance.com										*
    // * Website:	https://nopadvance.com										*
    // *                                                                       	*
    // **************************************************************************
    // *                                                                       	*
    // * Please see the  License file for the full End User License Agreement. 	*
    // * The  complete license agreement is also available on  our  website at 	*
    // * https://nopadvance.com/license-terms									*
    // *                                                                       	*
    // * This  software / plugin  is furnished  under a license  and  may   be  *
    // * used  and modified  only in accordance with the terms of such license  *
    // * and with the inclusion of the above copyright notice.  This  software	*
    // * or any other copies thereof may not be  provided  or  otherwise  made	*
    // * available  to any other person.  No title to  and  ownership  of  the  *
    // * software is hereby transferred.                                        *
    // *                                                                       	*
    // * You may not reverse  engineer, decompile, defeat  license  encryption 	*
    // * mechanisms  or  disassemble this software product or software product 	*
    // * license.  NopAdvance may terminate this  license if you don't  comply 	*
    // * with any of the terms & conditions set forth in our  end user license	*
    // * agreement (EULA).  In such event , licensee agrees to return licensor	*
    // * or destroy  all copies of software  upon termination  of the license.	*
    // *                                                                       	*
    // **************************************************************************
*@
@model PollModel
<div class="poll" id="poll-block-@(Model.Id)">
    <strong class="poll-display-text">@Model.Name</strong>
    @if (Model.AlreadyVoted)
    {
        <ul class="poll-results">
            @foreach (var item in Model.Answers)
            {
                <li class="answer">
                    @string.Format(T("Polls.VotesResultLine").Text, item.Name, item.NumberOfVotes, item.PercentOfTotalVotes.ToString("0.0"))
                </li>
            }
        </ul>
        <span class="poll-total-votes">@string.Format(T("Polls.TotalVotes").Text, Model.TotalVotes)</span>
    }
    else
    {
        <ul class="poll-options">
            @foreach (var item in Model.Answers)
            {
                <li class="answer">
                    <div class="custom-radio">
                        <input class="custom-control-input" id="pollanswers-@(item.Id)" type="radio" name="pollanswers-@(Model.Id)" value="@item.Id" />
                        <label class="custom-control-label" for="pollanswers-@(item.Id)">@item.Name</label>
                    </div>
                </li>
            }
        </ul>
        <div class="buttons">
            <button type="button" id="vote-poll-@(Model.Id)" class="button-2 vote-poll-button">@T("Polls.Vote")</button>
            <span id="poll-voting-progress-@(Model.Id)" style="display: none;" class="please-wait">@T("Common.Wait")</span>
        </div>
        <div class="poll-vote-error" id="block-poll-vote-error-@(Model.Id)" style="display:none">
        </div>
        <script asp-location="Footer">
            $(function() {
                $('#vote-poll-@(Model.Id)').on('click', function () {
                    var pollAnswerId = $("input:radio[name=pollanswers-@(Model.Id)]:checked").val();
                    if (typeof (pollAnswerId) == 'undefined') {
                        alert('@Html.Raw(JavaScriptEncoder.Default.Encode(T("Polls.SelectAnswer").Text))');
                    }
                    else {
                        var voteProgress = $("#poll-voting-progress-@(Model.Id)");
                        voteProgress.show();

                        var postData = {
                          "pollAnswerId": pollAnswerId
                        };
                        addAntiForgeryToken(postData);

                        $.ajax({
                            cache: false,
                            type: "POST",
                            url: "@(Url.RouteUrl("PollVote"))",
                            data: postData,
                            success: function (data, textStatus, jqXHR) {
                                if (data.error) {
                                    $("#block-poll-vote-error-@(Model.Id)").html(data.error);
                                    $('#block-poll-vote-error-@(Model.Id)').fadeIn("slow").delay(2000).fadeOut("slow");
                                }
                                if (data.html) {
                                    $("#poll-block-@(Model.Id)").replaceWith(data.html);
                                }
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert('Failed to vote.');
                            },
                            complete: function (jqXHR, textStatus) {
                                voteProgress.hide();
                            }
                        });
                    }
                    return false;
                });
            });
        </script>
    }
</div>
